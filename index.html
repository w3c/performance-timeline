<!DOCTYPE html>
<html>

<head>
  <title>Performance Timeline</title>
  <meta charset='utf-8'>
  <script src='//www.w3.org/Tools/respec/respec-w3c-common' async class='remove'></script>
  <script class='remove'>
  var respecConfig = {
    shortName: "performance-timeline",
    specStatus: "ED",
    edDraftURI: "https://w3c.github.io/performance-timeline/",
    // publishDate: "2013-10-23",
    editors: [{
      name: "Ilya Grigorik",
      url: "https://www.igvita.com/",
      mailto: "igrigorik@gmail.com",
      company: "Google",
      companyURL: "https://www.google.com/",
      w3cid: "56102"
    },{
      name: "Jatinder Mann",
      mailto: "jmann@microsoft.com",
      company: "Microsoft Corp.",
      note: "Until November 2014"
    },{
      name: "Zhiheng Wang",
      company: "Google",
      note: "Until July 2013"
    }],
    wg: "Web Performance Working Group",
    wgURI: "http://www.w3.org/2010/webperf/",
    wgPublicList: "public-web-perf",
    subjectPrefix: "[Performance Timeline]",
    format: "markdown",
    otherLinks: [{
      key: 'Repository',
      data: [{
        value: 'We are on GitHub',
        href: 'https://github.com/w3c/performance-timeline/'
      }, {
        value: 'Commit history',
        href: 'https://github.com/w3c/performance-timeline/commits/gh-pages/index.html'
      }, {
        value: 'File a bug',
        href: 'https://github.com/w3c/performance-timeline/issues'
      }]
    }],
    wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/45211/status"
  };
  </script>
</head>

<body>
  <section id='abstract'>
    <p>This specification defines a unified interface to store and retrieve high resolution performance metric data.</p>
  </section>

  <section id='sotd'>
    <p>This is a <strong>work in progress</strong> and may change without any notices.</p>
  </section>

  <section class='informative'>
    <h2>Introduction</h2>

    <p>Accurately measuring performance characteristics of web applications is an important aspect of making web applications faster. This specification defines the necessary <a>Performance Timeline</a> primitives that enable web developers to access, instrument, and retrieve various performance metrics from the full lifecycle of a web application.</p>

    <p>[[NAVIGATION-TIMING]], [[RESOURCE-TIMING]], and [[USER-TIMING]] are examples of specifications that define timing information related to the navigation of the document, resources on the page, and developer scripts, respectively. Together these and other performance interfaces define performance metrics that describe the <a>Performance Timeline</a> of a web application. For example, the following script shows how a developer can access the <a>Performance Timeline</a> to obtain performance metrics related to the navigation of the document, resources on the page, and developer scripts:</p>

    <pre class="highlight example">
&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body onload="init()"&gt;
    &lt;img id="image0" src="http://www.w3.org/Icons/w3c_main.png" /&gt;
    &lt;script&gt;
       function init()
       {
            performance.mark("startWork"); // see [[User Timing]]
            doWork(); // Some developer code
            performance.mark("endWork");

            measurePerf();
       }

       function measurePerf()
       {
           var perfEntries = performance.getEntries();
           for (var i = 0; i &lt; perfEntries.length; i++)
           {
                 if (window.console) console.log("Name: "        + perfEntries[i].name      +
                                                 " Entry Type: " + perfEntries[i].entryType +
                                                 " Start Time: " + perfEntries[i].startTime +
                                                 " Duration: "   + perfEntries[i].duration  +
                                                 " Group: "      + perfEntries[i].group + "\n");
           }
       }
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
    </pre>

    <p>Alternatively, instead of processing metrics at a predefined time, or having to periodically poll the timeline for new metrics, the developer may also observe the <a>Performance Timeline</a> and be notified of new performance metrics via a <a>Performance Observer</a>:</p>

    <pre class="highlight example">
    var observedEvents = [];
    var observer = new PerformanceObserver(function(list) {
      observedEvents.push(list); // defer processing
    });

    // subscribe to Frame-Timing and User-Timing events
    observer.observe({eventTypes: ['render', 'composite', 'mark', 'measure']});
    observer.disconnect();

    // processing logic called by application code
    function processObservedPerfEvents() {
      observedEvents.forEach(function(list) {
            var entries = list.getEntries();
            // application processing logic
      }
    }
    </pre>
  </section>

  <section>
    <h2><dfn>Performance Timeline</dfn></h2>

    <p>The <a>Performance Timeline</a> enables the user agent and application developers to access, instrument, and retrieve various performance metrics from the full lifecycle of a web application.</p>

    <p>All interfaces that participate in the <a>Performance Timeline</a> MUST adhere to the following rules:</p>

    <ul>
      <li>MUST extend the <a>PerformanceEntry</a> interface</li>
      <li>MUST be supported by the <a href="#widl-Performance-getEntries-PerformanceEntryList">getEntries</a>, <a href="#widl-Performance-getEntriesByType-PerformanceEntryList">getEntriesByType</a>, <a href="#widl-Performance-getEntriesByName-PerformanceEntryList">getEntriesByName</a>, and <a href="#widl-Performance-getEntriesByGroup-PerformanceEntryList">getEntriesByGroup</a> methods.</li>
      <li>SHOULD surface new performance metrics in a timely manner</li>
      <ul>
        <li>The user agent is NOT REQUIRED to provide synchronous access to new performance metrics</li>
        <li>The user agent MAY delay reporting the metric to avoid performance bottlenecks</li>
      </ul>
    </ul>

      <section>
        <h2>The <dfn>PerformanceEntry</dfn> interface</h2>
        <p>The <a>PerformanceEntry</a> interface hosts the performance data of various metrics.</p>

        <dl title='[Exposed=(Window,Worker)] interface PerformanceEntry' class='idl'>
          <dt>readonly attribute DOMString name</dt>
          <dd>The attribute MUST return a <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString">DOMString</a> identifier for this <a>PerformanceEntry</a> object. This identifier does not have to be unique.</dd>
          <dt>readonly attribute DOMString entryType</dt>
          <dd>This attribute MUST return a <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString">DOMString</a> that describes the <a href="http://www.w3.org/wiki/Web_Performance/EntryType">type of the interface</a> represented by this <a>PerformanceEntry</a> object.</dd>
          <dt>readonly attribute DOMString startTime</dt>
          <dd>The attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a> that contains the time value of the first recorded timestamp of this performance metric.</dd>
          <dt>readonly attribute DOMString duration</dt>
          <dd>The attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a> that contains the time value of the duration of the entire event being recorded by this <a>PerformanceEntry</a>. Typically, this would be the time difference between the last recorded timestamp and the first recorded timestamp of this <a>PerformanceEntry</a>. If the duration concept doesn't apply, a performance metric may choose to return a `duration` of 0.</dd>
          <dt>readonly attribute DOMString group</dt>
          <dd>This attribute MUST return a <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString">DOMString</a> identifier that may be used to associate one or more <a>PerformanceEntry</a> objects into an event group - e.g. an event that results in generation of multiple <a>PerformanceEntry</a> objects may group them by returning the same group identifier. This attribute MUST be unique for <a>PerformanceEntry</a> objects that do not belong to the same event group.</dd>
          <dt>serializer = { attribute }</dt>
        </dl>
      </section>

      <section>
        <h2>The <dfn>Performance</dfn> interface</h2>

        <p>The <a>Performance</a> interface hosts performance related attributes and methods used to retrieve the performance metric data from the <a>Performance Timeline</a>.</p>

        <dl title='[Exposed=(Window,Worker)] interface Performance : EventTarget' class='idl'>
          <dt>PerformanceEntryList getEntries()</dt>
          <dd>This method returns a <a>PerformanceEntryList</a> object that contains a copy of all <a>PerformanceEntry</a> objects in chronological order with respect to <a href="#widl-PerformanceEntry-startTime">startTime</a>.</dd>

          <dt>PerformanceEntryList getEntriesByType(DOMString entryType)</dt>
          <dd>This method returns a <a>PerformanceEntryList</a> object that contains a copy of all <a>PerformanceEntry</a> objects, in chronological order with respect to <a href="#widl-PerformanceEntry-startTime">startTime</a>, that have the same value for the <a href="#widl-PerformanceEntry-entryType">entryType</a> attribute of <a>PerformanceEntry</a> as the <a href="#widl-PerformanceEntry-entryType">entryType</a> parameter. If no such <a>PerformanceEntry</a> objects exist, the <a>PerformanceEntryList</a> must be empty.</dd>

          <dt>PerformanceEntryList getEntriesByName(DOMString name, optional DOMString entryType)</dt>
          <dd>This method returns a <a>PerformanceEntryList</a> object that contains a copy of <a>PerformanceEntry</a> objects, in chronological order with respect to <a href="#widl-PerformanceEntry-startTime">startTime</a>, that have the same value for the <a href="#widl-PerformanceEntry-name">name</a> attribute of <a>PerformanceEntry</a> as the <a href="#widl-PerformanceEntry-name">name</a> parameter and, if specified, have the same value for the <a href="#widl-PerformanceEntry-entryType">entryType</a> attribute of <a>PerformanceEntry</a> as the <a href="#widl-PerformanceEntry-entryType">entryType</a> parameter. If no such <a>PerformanceEntry</a> objects exist, the <a>PerformanceEntryList</a> must be empty.</dd>

          <dt>PerformanceEntryList getEntriesByGroup(DOMString group)</dt>
          <dd>This method returns a <a>PerformanceEntryList</a> object that contains a copy of <a>PerformanceEntry</a> objects, in chronological order with respect to <a href="#widl-PerformanceEntry-startTime">startTime</a>, that have the same value for the <a href="#widl-PerformanceEntry-group">group</a> attribute of <a>PerformanceEntry</a> as the <a href="#widl-PerformanceEntry-group">group</a> parameter. If no such <a>PerformanceEntry</a> objects exist, the <a>PerformanceEntryList</a> must be empty.</dd>
        </dl>

        <dl class="idl" title="typedef sequence PerformanceEntry PerformanceEntryList"></dl>

        <dl class='idl' title='[NoInterfaceObject, Exposed=(Window,Worker)] interface GlobalPerformance'>
        <dt>[Replaceable] readonly attribute Performance performance</dt>
        <dd>
        <p>This attribute allows access to performance related attributes and methods.</p>
        </dd>
        </dl>
        <pre class='idl'>
        Window implements GlobalPerformance;
        WorkerGlobalScope implements GlobalPerformance;
        </pre>
      </section>

    <section>
      <h2>The <dfn>Performance Observer</dfn> interface</h2>

      <p>The <a>PerformanceObserver</a> interface can be used to observe the <a>Performance Timeline</a> and be notified of new performance entries as they are recorded by the user agent. A <dfn>registered performance observer</dfn> consists of an observer (a <a>PerformanceObserver</a> object) and options (a <a>PerformanceObserverInit</a> dictionary).</p>

      <dl title='callback PerformanceObserverCallback = void (LazyPerformanceEntryList eventList, PerformanceObserver observer)' class='idl'></dl>

      <dl title='[Constructor(PerformanceObserverCallback callback), Exposed=(Window,Worker)] interface PerformanceObserver' class='idl'>

        <dt>void observe(PerformanceObserverInit options)</dt>
        <dd>This method instructs the user agent to <dfn>register the observer</dfn> and report any new performance entries based on the criteria given by <a>options</a>.
          <dl title='dictionary PerformanceObserverInit' class='idl'>
            <dt>sequence&lt;DOMString&gt; typeFilter</dt>
            <dd>
              <p>A list of valid <a href="#widl-PerformanceEntry-entryType">entryType names</a> to be observed. The list MUST NOT be empty and types not recognized by the user agent MUST be ignored.</p>

              <p class="note">To keep the performance overhead to minimum the application should only subscribe to event types that it is interested in, and disconnect the observer once it no longer needs to observe the performance data. Filtering by name is not supported, as it would implicitly require a subscription for all event types &mdash; this is possible, but discouraged, as it will generate a significant volume of events.</p>
            </dd>
          </dl>

          <p>The `observe(options)` method must run these steps:</p>
          <ol>
            <li>If _options'_ `typeFilter` attribute is not present, <a href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a JavaScript `AbortError`.</li>
            <li>Filter unsupported <a href="#widl-PerformanceEntry-entryType">entryType names</a> within the `typeFilter` sequence, and replace the `typeFilter` sequence with the new filtered sequence.</li>
            <li>If the _options'_ `typeFilter` attribute is an empty sequence, <a href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a JavaScript `AbortError`.</li>
            <li>Add a new <a>registered performance observer</a> with the <a href="http://www.w3.org/TR/dom/#context-object">context object</a> as the <dfn>observer</dfn> and _options_ as the `options`.</li>
          </ol>
        </dd>

        <dt>void disconnect()</dt>
        <dd>This method must remove the <a>registered performance observer</a> from the <a>Performance Timeline</a> for which the <a href="http://www.w3.org/TR/dom/#context-object">context object</a> is the <a>observer</a>.</dd>
      </dl>

      <section>
        <h2>The <dfn>LazyPerformanceEntryList</dfn> interface</h2>

        <p>The <a>LazyPerformanceEntryList</a> interface provides the same `getEntries`, `getEntriesByType`, `getEntriesByName` methods as the <a>Performance</a> interface, except that <a>LazyPerformanceEntryList</a> operates on the observed emitted list of events instead of the global timeline.</p>

        <dl title='[Exposed=(Window,Worker)] interface LazyPerformanceEntryList' class='idl'>
          <dt>PerformanceEntryList getEntries()</dt>
          <dd>See <a href="#widl-Performance-getEntries-PerformanceEntryList">performance.getEntries</a>.</dd>
          <dt>PerformanceEntryList getEntriesByType(DOMString entryType)</dt>
          <dd>See <a href="#widl-Performance-getEntriesByType-PerformanceEntryList">performance.getEntriesByType</a>.</dd>
          <dt>PerformanceEntryList getEntriesByName(DOMString name, optional DOMString entryType)</dt>
          <dd>See <a href="#widl-Performance-getEntriesByName-PerformanceEntryList">performance.getEntriesByName</a>.</dd>
        </dl>
      </section>

    </section>
  </section>


  <section>
    <h2>Vendor Extensions</h2>
    <p>If a vendor-specific proprietary user agent extension is needed to create experimental <a>PerformanceEntry</a> objects, on getting the <a href="#idl-PerformanceEntry-entryType">entryType</a> IDL attribute, vendors MUST return a `DOMString` that uses the following convention:</p>
    <pre>[vendorPrefix]-[entryType]</pre>
    <p>Where, `[vendorPrefix]` is a non-capitalized name that identifies the vendor, `[entryType]` is a non-capitalized name given to the type of   interface represented by this <a>PerformanceEntry</a> object, and the above names are in ASCII.</p>
  </section>


  </section>
</body>
</html>
